<?php/*---------------------------------------------------------------+| eXtreme-Fusion - Content Management System - version 5         |+----------------------------------------------------------------+| Copyright (c) 2005-2012 eXtreme-Fusion Crew                	 || http://extreme-fusion.org/                               		 |+----------------------------------------------------------------+| This product is licensed under the BSD License.				 || http://extreme-fusion.org/ef5/license/						 |+---------------------------------------------------------------*/try{	require_once '../../../system/sitecore.php';	include DIR_MODULES.'google_analytics'.DS.'class'.DS.'Gapi.php';		if ($_user->isLoggedIn())	{		if(isset($_GET['GetGoogleAnalitics']) && $_GET['GetGoogleAnalitics'] === 'True')		{			if ($_user->hasPermission('module.google_analytics.preview'))			{				$row = $_pdo->getRow('SELECT * FROM [google_analytics_sett]');								$google_analytics = new gapi($row['email'], $row['password']);				$dimensions = array(						'source',						'networkDomain',						'browser',						'browserVersion',						'operatingSystem',						'operatingSystemVersion',						'country'				);				$metrics = array(						'pageviews',						'visits'				);				$google_analytics->requestReportData($row['account_id'], $dimensions, $metrics, '-visits');								$google_analytics_list = '{"aaData":[';				if ( ! is_array($google_analytics->Error))				{					foreach ($google_analytics->getResults() as $result)					{						$google_analytics_list .= '["'.$result->networkDomain().'","'.$result->source().'","'.$result->browser().' '.$result->browserVersion().'","'.$result->operatingSystem().' '.$result->operatingSystemVersion().'","'. $result->country().'","'.number_format($result->getPageviews(), 0, '', '.').'","'.number_format($result->getVisits(), 0, '', '.').'"],';					}				}				$google_analytics_list .= ']}';				$google_analytics_list = str_replace(',]}', ']}', $google_analytics_list);				_e($google_analytics_list);			}			$google_analytics_list = '{"aaData":[';			$google_analytics_list .= ']}';			_e($google_analytics_list);		}	}}catch(optException $exception){    optErrorHandler($exception);}catch(systemException $exception){    systemErrorHandler($exception);}catch(userException $exception){    userErrorHandler($exception);}catch(PDOException $exception){    PDOErrorHandler($exception);}